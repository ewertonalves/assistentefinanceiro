spring.main.allow-circular-references=true

# Config do banco de dados H2
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=password

# Configuração do Connection Pool (HikariCP) 
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.connection-test-query=SELECT 1

# Config do JPA
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false

# Otimizações de performance do Hibernate para múltiplos usuários
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.properties.hibernate.generate_statistics=false
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.cache.use_query_cache=false

# Configuração de isolamento de transação
spring.jpa.properties.hibernate.connection.isolation=2

# Config do H2 Console
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console

# Config de segurança JWT
jwt.secret=${JWT_SECRET:myVerySecureAndLongSecretKeyForJWTTokenGeneration2024WithExtraCharactersToMeet512BitsRequirement!@#$%}
jwt.expiration=${JWT_EXPIRATION:3600}

# Config do Swagger
springdoc.swagger-ui.path=/swagger-ui.html

# Config da OpenAI (DESABILITADA)
# Para habilitar a OpenAI, descomente as linhas abaixo e remova a exclusão da auto-configuração
# spring.ai.openai.api-key=${OPENAI_API_KEY:}
# spring.ai.openai.chat.enabled=true
# spring.ai.openai.audio.speech.enabled=false
# spring.ai.openai.chat.options.model=gpt-3.5-turbo
# spring.ai.openai.chat.options.temperature=0.7
# spring.ai.openai.chat.options.max-tokens=500

# Config do Prometheus e metricas
management.endpoints.web.exposure.include=*
management.endpoint.health.show-details=always
management.endpoint.metrics.access=unrestricted
management.endpoint.prometheus.access=unrestricted
management.prometheus.metrics.export.enabled=true
management.metrics.tags.application=assitentefinanceiro

# Config do Spring Boot Admin
spring.boot.admin.server.ui.title=Assistente Financeiro Admin Dashboard
spring.boot.admin.server.ui.brand=Assistente Financeiro
spring.boot.admin.server.context-path=/admin
spring.application.name=assitentefinanceiro

spring.boot.admin.client.enabled=false

# Config do Ollama
ollama.base-url=${OLLAMA_BASE_URL:http://localhost:11434}
ollama.api-key=${OLLAMA_API_KEY:}
ollama.model=${OLLAMA_MODEL:Ewerton_Virginio/assitentefinanceiro}

# Configuração do Spring AI para Ollama
# O Spring AI usa essas propriedades diretamente para criar o ChatModel
spring.ai.ollama.base-url=${OLLAMA_BASE_URL:http://localhost:11434}
spring.ai.ollama.api-key=${OLLAMA_API_KEY:}
spring.ai.ollama.chat.enabled=true
spring.ai.ollama.chat.options.model=${OLLAMA_MODEL:Ewerton_Virginio/assitentefinanceiro}
spring.ai.ollama.chat.options.temperature=0.7
spring.ai.ollama.chat.options.top-p=0.9

# Configuração do Thread Pool do Tomcat - Essencial para concorrência
# Aumenta o número de threads disponíveis para processar requisições simultâneas
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10
server.tomcat.max-connections=10000
server.tomcat.accept-count=100
server.tomcat.connection-timeout=20000

# Configuração de cache do Spring Cache
spring.cache.type=caffeine
spring.cache.cache-names=contas,usuarios,movimentacoes
spring.cache.caffeine.spec=maximumSize=500,expireAfterWrite=5m,expireAfterAccess=10m
